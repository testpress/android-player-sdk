tasks.register("runPlayerLibraryTask") {
    dependsOn tasks.copyPlayerViewXML
}

tasks.register("deleteAllMappingFiles", Delete) {
    delete layout.projectDirectory.dir("src/main/java/com/tpstream/player/Mapping.kt")
    delete layout.projectDirectory.dir("src/main/res/layout/exo_player_control_view.xml")
    delete layout.projectDirectory.dir("src/main/res/layout/exo_styled_player_control_view.xml")
}

tasks.register("copyMappingFiles", Copy) {
    dependsOn tasks.deleteAllMappingFiles

    def mappingFile = useMedia3Library ? "Media3PlayerMapping.kt" : "ExoPlayerMapping.kt"

    from project.provider { layout.projectDirectory.file("src/main/assets/$mappingFile") }
    into project.provider { layout.projectDirectory.dir("src/main/java/com/tpstream/player") }
    rename mappingFile, 'Mapping.kt'
}

tasks.register("copyPlayerControlViewXML", Copy) {
    dependsOn tasks.copyMappingFiles

    def controlViewFile = useMedia3Library ? "exo_player_control_view.xml" : "exo_styled_player_control_view.xml"

    from project.provider { layout.projectDirectory.file("src/main/assets/$controlViewFile") }
    into project.provider { layout.projectDirectory.dir("src/main/res/layout") }
}

tasks.register("copyPlayerViewXML", Copy) {
    dependsOn tasks.copyPlayerControlViewXML

    def viewFile = useMedia3Library ? "exo_player_view.xml" : "exo_styled_player_view.xml"
    def mappedViewFile = "mapped_exo_player_view.xml"

    from project.provider { layout.projectDirectory.file("src/main/assets/$viewFile") }
    into project.provider { layout.projectDirectory.dir("src/main/res/layout") }
    rename viewFile, mappedViewFile
}